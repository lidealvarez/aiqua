<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reductor Data Analysis</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        select, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Reductor Data Analysis</h1>
        <form action="/load_data" id="data-form" method="post" onsubmit="return validateForm()">
            <div class="form-section">
                <select id="reductor-select" name="reductor_id">
                    <option value="">Select a Reductor</option>
                    <!-- Reductor options will be populated here -->
                </select>
            </div>
            <div class="form-section">
                <label for="start_month">Start Month (YYYY-MM):</label>
                <input type="month" id="start_month" name="start_month">
                <label for="end_month">End Month (YYYY-MM):</label>
                <input type="month" id="end_month" name="end_month">
            </div>
            <div class="form-section">
                <label for="detailed_month">Detailed Month (YYYY-MM):</label>
                <input type="month" id="detailed_month" name="detailed_month">
                <small>Select this for detailed analysis of a single month within the range above.</small>
            </div>
            <input type="submit" value="Load Data">
        </form>
    </div>
	        <!-- Display the plot image -->
        {% if plot_url != 'default_value_if_not_set' %}
            <div class="form-section">
                <iframe src="{{ url_for('static', filename=plot_url) }}" style="width:100%; height:600px;"></iframe>
            </div>
        {% else %}
            <p>No plot available. Please upload a file and select months.</p>
        {% endif %}
    <script>
        function validateForm() {
            var startMonth = document.getElementById("start_month").value;
            var endMonth = document.getElementById("end_month").value;
            var detailedMonth = document.getElementById("detailed_month").value;

            if ((startMonth && endMonth) && detailedMonth) {
                alert("Please select either a range of months or a detailed single month, not both.");
                return false;
            }

            if ((!startMonth || !endMonth) && !detailedMonth) {
                alert("Please select either a range of months or a detailed single month.");
                return false;
            }

            return true;
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetch('/get_reductors').then(response => response.json()).then(data => {
                const select = document.getElementById('reductor-select');
                data.forEach(reductor => {
                    const option = document.createElement('option');
                    option.value = reductor.reductorID;
                    option.textContent = reductor.name;
                    select.appendChild(option);
                });
            });

            document.getElementById('data-form').addEventListener('submit', function(event) {
                event.preventDefault();
                if (!validateForm()) return;

                // Prepare data to be sent
                const formData = new FormData(this);

                fetch('/load_data', {
                    method: 'POST',
                    body: formData
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
    </script>
</body>
</html>
